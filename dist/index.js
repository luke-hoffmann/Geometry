import {UsefulFunction}from'usefulfunction';import {ColorHandler}from'colorhandler';var y=class{#e;#t;constructor(e,t){if(e==null)throw Error("Color is not defined");if(t==null)throw Error("Brightness is not defined");if(0>t||t>1)throw Error("Brightness is not between 0 and 1");e=e.clampColor(),this.#e=e,this.#t=t;}calculateObservedColor(e){let r=this.#e.multiplyByNumber(this.#t).multiplyByNumber(1/255),i=e.multiplyByNumber(1/255).elementWiseMultiplication(r);return i=i.multiplyByNumber(255),i}get color(){return this.#e.copy()}get brightness(){return this.#t}static hasPosition(e){return "position"in e}};var n=class l{#e;#t;#r;constructor(e,t,r){this.#e=e,this.#t=t,this.#r=r;}get x(){return this.#e}get y(){return this.#t}get z(){return this.#r}static zero(){return new this(0,0,0)}set z(e){if(!Number.isFinite(e))throw Error("n is not finite");this.#r=e;}static isVectorEqual(e,t){if(!(e instanceof l))throw Error("v1 must be a vector");if(!(t instanceof l))throw Error("v2 must be a vector");return e.x===t.x&&e.y===t.y&&t.z===t.z}static unitVector(e){if(!(e instanceof l))throw Error("v must be a vector");let t=e.magnitude();return new this(e.x/t,e.y/t,e.z/t)}static upVector(){return new this(0,1,0)}static downVector(){return new this(0,-1,0)}static generateVectorInSphere(e){e=Math.random()*e*e*e,e=Math.cbrt(e);let t=2,r=0,o=0,i=0;for(;t>1;)r=Math.random()*2-1,o=Math.random()*2-1,i=Math.random()*2-1,t=r*r+o*o+i*i;return new l(r*e,o*e,i*e)}equals(e){return e.x==this.#e&&e.y==this.#t&&e.z==this.#r}static magnitude(e){if(!(e instanceof l))throw Error("p1 must be a vector");return e.magnitude()}magnitude(){return Math.hypot(this.x,this.y,this.z)}static distanceBetweenVectors(e,t){if(!(e instanceof l))throw Error("v1 must be a vector");if(!(t instanceof l))throw Error("v2 must be a vector");return Math.hypot(e.x-t.x,e.y-t.y,e.z-t.z)}static lerp(e,t,r){if(!Number.isFinite(e))throw Error("p1 is not a finite number");if(!Number.isFinite(t))throw Error("p2 is not a finite number");if(!Number.isFinite(r))throw Error("t is not a finite number");return (t-e)*r+e}static lerpVector(e,t,r){return new this(this.lerp(e.x,t.x,r),this.lerp(e.y,t.y,r),this.lerp(e.z,t.z,r))}static crossProduct(e,t){return new this(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}static dotProduct(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static sub(e,t){return new this(e.x-t.x,e.y-t.y,e.z-t.z)}static add(...e){let t=0,r=0,o=0;for(let i of e)t+=i.x,r+=i.y,o+=i.z;return new l(t,r,o)}static scalarMult(e,t){return new this(e.x*t,e.y*t,e.z*t)}isDotProductLEThanX(e,t){return l.dotProduct(this,e)<=t}copy(){return new l(this.#e,this.#t,this.#r)}static oppositeVector(e){return this.scalarMult(e,-1)}};var E=class l extends y{#e;constructor(e,t,r){super(e,t),this.#e=r;}copy(){return new l(this.color,this.brightness,this.#e)}calculateTriangleColor(e){let t=n.unitVector(n.sub(this.#e,e.trianglePosition)),r=Math.max(0,n.dotProduct(t,e.triangleNormalVector)),o=this.calculateObservedColor(e.triangleColor);return o=o.multiplyByNumber(r),o}get position(){return this.#e}set position(e){this.#e=e;}};var A=class l extends y{#e;constructor(e,t,r){super(e,t),this.#e=r;}copy(){return new l(this.color,this.brightness,this.#e)}calculateTriangleColor(e){let t=n.dotProduct(this.#e,e.triangleNormalVector),r=this.calculateObservedColor(e.triangleColor);return r=r.multiplyByNumber(t),r}};var M=class l{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}worldPositionOfDirection(){return n.add(this.#e,this.#t)}copy(){return new l(this.#e.copy(),this.#t.copy())}get position(){return this.#e}get direction(){return this.#t}};var V=class l{#e;constructor(e){this.#e=e;}logReferences(){console.log(this.#e[0],this.#e[1],this.#e[2]);}doesUpspaceContain(e,t){let r=n.sub(e.getVertex(t),e.getVertex(this.#e[0])),o=this.computeNormal(e),i=n.dotProduct(r,o);return !(Math.abs(i)<1e-5||i<0)}computeCentroid(e){let t=e.getVertex(this.#e[0]),r=e.getVertex(this.#e[1]),o=e.getVertex(this.#e[2]),i=n.lerpVector(t,r,.5);return n.lerpVector(i,o,.33333)}static isDotProductLEThanX(e,t,r){throw Error("function has been moved to the vector class.")}computeNormal(e){let t=n.sub(e.getVertex(this.#e[0]),e.getVertex(this.#e[1])),r=n.sub(e.getVertex(this.#e[2]),e.getVertex(this.#e[0])),o=n.crossProduct(t,r);return n.unitVector(o)}distanceTo(e,t){let r=this.computeNormal(e),o=e.getVertex(this.#e[0]),i=-(r.x*o.x+r.y*o.y+r.z*o.z);return Math.abs(r.x*t.x+r.y*t.y+r.z*t.z+i)/Math.sqrt(r.x**2+r.y**2+r.z**2)}getFarthestPoint(e,t){if(!(t.length>0))throw Error("pointIndices must contain at least one entry");let r=t[0],o=0;for(let i of t){let s=e.getVertex(i),a=this.distanceTo(e,s);a>o&&(o=a,r=i);}return r}flipNormal(){return new l([this.#e[2],this.#e[1],this.#e[0]])}getVerticeReference(e){return this.#e[e]}static addPointsFromTrianglesToMap(e,t){for(let r=0;r<t.length;r++){for(let o=0;o<2;o++)UsefulFunction.addToMap(e,t[r].getVerticeReference(o),t[r].getVerticeReference(o+1));UsefulFunction.addToMap(e,t[r].getVerticeReference(2),t[r].getVerticeReference(0));}}static createPyramidFromBoundaryPoints(e,t){let r=[];for(let o=0;o<e.length-1;o++){let i=new this([t,e[o],e[o+1]]);r.push(i);}return r.push(new this([t,e[e.length-1],e[0]])),r}copy(){let e=[];for(let t of this.#e)e.push(t);return new l(e)}getDistinctIdentifier(){return this.#e[0].toString()+this.#e[1].toString()+this.#e[2].toString()}calculateTriangleNormalVector(e){let t=this.computeCentroid(e),r=this.computeNormal(e);return new M(t,r)}};var T=class{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}get p1(){return this.#e}get p2(){return this.#t}isEqual(e){return this===e||this.#e===e.p1&&this.#t===e.p2||this.#e===e.p2&&this.#t==e.p1}distanceToPoint(e){let t=n.sub(e,this.#e),r=n.sub(this.#t,this.#e);return n.magnitude(n.crossProduct(t,r))/n.magnitude(r)}};var g=class l{array;constructor(e){this.array=e,e==null&&(this.array=[]);}getVertex(e){return this.array[e]}generateRandomPointsInSphere(e,t){this.array=[];for(let r=0;r<t;r++)this.array.push(n.generateVectorInSphere(e));}getTrianglesUpspace(e,t){let r=[];for(let o of t)o==e.getVerticeReference(0)||o==e.getVerticeReference(1)||o==e.getVerticeReference(2)||e.doesUpspaceContain(this,o)&&r.push(o);return r}getTrianglesWithPointInUpspace(e,t){let r=[],o;for(let i=0;i<e.length;i++)o=e[i],o.doesUpspaceContain(this,t)&&r.push(o);return r}getTriangleIndicesWithPointInUpspace(e,t){let r=[],o;for(let i=0;i<e.length;i++)o=e[i],o.doesUpspaceContain(this,t)&&r.push(i);return r}getTrianglesUpspaces(e,t){let r=[];for(let o of e)r.push(this.getTrianglesUpspace(o,t));return r=UsefulFunction.combineArrays(r),UsefulFunction.noDuplicates(r)}getTrianglesUpspaces_Fast(e,t){let r=[];for(let o of e){let i=[];for(let s of t){if(s==o.getVerticeReference(0)||s==o.getVerticeReference(1)||s==o.getVerticeReference(2))continue;let a=this.getVertex(s),h=this.getVertex(o.getVerticeReference(0)),c=a.x-h.x,u=a.y-h.y,p=a.z-h.z,m=o.computeNormal(this);c*m.x+u*m.y+p*m.z;o.doesUpspaceContain(this,s)&&i.push(s);}r.push(i);}return r=UsefulFunction.combineArrays(r),UsefulFunction.noDuplicates(r)}getAverageDistanceBetweenPointsAndTriangles(e,t){let r=[];for(let o of t){let i=0;for(let a of e)i+=a.distanceTo(this,this.getVertex(o));let s=i/e.length;r.push(s);}return r}getFarthestPointFromTriangles(e,t){let r=this.getFarthestPointsFromTriangles(e,t),o=this.getAverageDistanceBetweenPointsAndTriangles(e,r),i=UsefulFunction.getIndexOfArrayMax(o);if(i==null)throw Error("Bad error");return r[i]}getFarthestPointFromTriangles_Fast(e,t){let r=t[0],o=-1/0;for(let i of t){let s=0,a=this.getVertex(i);for(let h of e){let c=h.computeNormal(this),u=this.getVertex(h.getVerticeReference(0)),p=-(c.x*u.x+c.y*u.y+c.z*u.z);s+=(c.x*a.x+c.y*a.y+c.z*a.z+p)/(c.x**2+c.y**2+c.z**2);}s>o&&(o=s,r=i);}return r}getFarthestPointsFromTriangles(e,t){let r=[];for(let i of e)r.push(i.getFarthestPoint(this,t));return r}getFarthestVectorFromVector(e){let t=0,o=-1,i=this.array[e];for(let s=0;s<this.array.length;s++){let a=n.distanceBetweenVectors(this.array[s],i);a>t&&(t=a,this.array[s],o=s);}if(o==-1)throw Error("no farthest distance point found at all");return o}calculateLargestTriangleFromField(){let e=this.lowestVectorInField(),t=this.getFarthestVectorFromVector(e),r=new T(this.array[e],this.array[t]),o=this.calculateFarthestPoint(r);return new V([e,t,o])}calculateFarthestPoint(e){let t=0,o=-1;for(let i=0;i<this.array.length;i++){if(n.isVectorEqual(this.array[i],e.p1)||n.isVectorEqual(this.array[i],e.p2))continue;let a=e.distanceToPoint(this.array[i]);t<a&&(this.array[i],t=a,o=i);}if(o==-1)throw Error("no farthest point found");return o}lowestVectorInField(){if(this.array.length==0)throw Error("array length is 0");let e=this.array[0],t=0;for(let r=0;r<this.array.length;r++)e.x>this.array[r].x&&(e=this.array[r],t=r,r=0);return t}moveEntireField(e){let t=[];for(let r=0;r<this.array.length;r++)t.push(n.add(this.array[r],e));return new l(t)}copy(){let e=[];for(let t of this.array)e.push(new n(t.x,t.y,t.z));return new l(e)}addVertex(e){let t=[];for(let r of this.array)t.push(new n(r.x,r.y,r.z));return t.push(e),new l(t)}get numPoints(){return this.array.length}};var P=class l{#e;#t;constructor(e,t){if(!(e instanceof g))throw Error("vertices is not an instance of Field");if(!Array.isArray(t))throw Error("triangles is not an array");this.#e=e,this.#t=t,e==null&&(this.#e=new g([])),t==null&&(this.#t=[]);}calculateAverageZ(){let e=0;for(let t=0;t<this.#e.numPoints;t++)e+=this.#e.getVertex(t).z;return e/this.#e.numPoints}calculateTrianglesNormalVectors(){let e=[];for(let t of this.#t)e.push(t.calculateTriangleNormalVector(this.#e));return e}mapTrianglesToAnyObject(e){if(this.numTriangles!==e.length)throw new Error("number of triangles does not equal number of objects");let t=new Map;for(let r=0;r<this.numTriangles;r++)t.set(this.getTriangle(r).getDistinctIdentifier(),e[r]);return t}findAnyObjectFromMap(e){let t=[];for(let r=0;r<this.numTriangles;r++){let o=this.getTriangle(r).getDistinctIdentifier(),i=e.get(o);i!==void 0&&t.push(i);}return t}copy(){let e=this.copyTriangles();return new l(this.#e.copy(),e)}copyTriangles(){let e=[];for(let t of this.#t)e.push(t.copy());return e}get vertices(){return this.#e.copy()}get triangles(){return this.copyTriangles()}get numPoints(){return this.#e.numPoints}get numTriangles(){return this.#t.length}getVertex(e){if(!Number.isSafeInteger(e))throw Error("index is not a safe integer");return this.#e.getVertex(e)}getTriangle(e){if(!Number.isSafeInteger(e))throw Error("index is not a safe integer");return this.#t[e]}set vertices(e){if(!(e instanceof g))throw Error("vertices must be an instance of Field");this.#e=e;}set triangles(e){if(!Array.isArray(e))throw Error("triangles is not an array");this.#t=e;}};var v=class l{static convexHullIterativeProcess(e,t,r){t=[...t];let o=e.getTrianglesUpspaces_Fast(t,r),i=o[0];if(o.length==1)i=o[0];else {if(o.length==0)return [];i=e.getFarthestPointFromTriangles_Fast(t,o);}let s=e.getTriangleIndicesWithPointInUpspace(t,i),a=e.getTrianglesWithPointInUpspace(t,i),h=new Map;V.addPointsFromTrianglesToMap(h,a);let c=UsefulFunction.getNodesOnOutsideOfCounterClockwiseGraph(h,1e5),u=V.createPyramidFromBoundaryPoints(c,i);return t=UsefulFunction.removeIndicesFromArray(t,s),t=l.addTrianglesToTrianglesArray(t,u),t}static addTrianglesToTrianglesArray(e,t){let r=[];e.forEach(o=>{r.push(o.copy());});for(let o of t)r.push(o);return r}static generateConvexMesh(e,t){let i;i=[e.calculateLargestTriangleFromField()],i.push(i[0].flipNormal());let s=UsefulFunction.arrayOfIndices(e.numPoints);i=this.convexHullIterativeProcess(e,i,s);for(let a=0;a<t;a++){let h=this.convexHullIterativeProcess(e,i,s);if(h.length==0)return new P(e,i);i=h;}return new P(e,i)}static generateRandomConvexMesh(e,t){let r=new g([]);return r.generateRandomPointsInSphere(e,t),this.generateConvexMesh(r,310)}};var B=class l{#e;#t;#r;#o;constructor(e,t,r,o){this.#e=e,e instanceof n||(this.#e=new n(0,0,0)),this.#t=t,t instanceof n||(this.#t=new n(0,0,0)),this.#r=r,r instanceof n||(this.#r=new n(0,0,0)),this.#o=o,o==null&&(this.#o=.01);}update(e){this.#e=n.add(this.#e,n.scalarMult(this.#t,e)),this.#t=n.add(this.#t,n.scalarMult(this.#r,e)),this.#t=n.scalarMult(this.#t,1-this.#o);}get position(){return this.#e.copy()}get velocity(){return this.#t.copy()}get acceleration(){return this.#r.copy()}set position(e){if(!(e instanceof n))throw Error("Position input is not of type Vector");this.#e=e;}set velocity(e){if(!(e instanceof n))throw Error("Velocity input is not of type Vector");this.#t=e;}set acceleration(e){if(!(e instanceof n))throw Error("Acceleration input is not of type Vector");this.#r=e;}copy(){return new l(this.#e.copy(),this.#t.copy(),this.#r.copy(),this.#o)}};var O=class l{#e;#t;#r;#o;constructor(e,t,r,o){this.#e=e,this.#t=t,this.#r=r,this.#o=o;}static randomConvexEntityWithColors(e,t,r,o,i,s){let a=v.generateRandomConvexMesh(e,t),h=ColorHandler.randomColorsBetween(a.numTriangles,o,i);return new this(a,r,h,s)}copy(){let e=[];for(let t of this.#r)e.push(t.copy());return new l(this.#e.copy(),this.#t.copy(),e,this.#o)}get triangleColors(){let e=[];for(let t of this.#r)e.push(t.copy());return e}get worldSpaceMesh(){let e=this.#e.copy(),t=[];for(let o=0;o<e.numPoints;o++)t.push(n.add(e.getVertex(o),this.#t.position));let r=new g(t);return e.vertices=r,e}get physicsBody(){return this.#t.copy()}get mesh(){return this.#e.copy()}get isIndifferentToLight(){return this.#o}};var R=class l{#e;#t;#r;#o;#n;#i;#s;constructor(e,t,r,o,i){this.#e=e,this.#t=n.unitVector(t),this.#r=r,this.#o=o,this.#n=i,this.#i=new n(0,1,0),this.#s=n.unitVector(n.crossProduct(t,this.#i));}get focalDistance(){return this.#o}get position(){return this.#e.position}set position(e){if(!(e instanceof n))throw Error("position is not an instance of Vector");this.#e.position=e;}set viewVector(e){this.#t=e,this.#i=new n(0,1,0),(e.equals(n.upVector())||e.equals(n.downVector()))&&(this.#i=new n(1,0,0)),this.#s=n.unitVector(n.crossProduct(e,this.#i)),this.#i=n.unitVector(n.crossProduct(e,this.#s));}putCameraAtCenterOfMeshCoordinateSystem(e){let t=e.copy(),r=[];for(let o=0;o<e.numPoints;o++){let i=e.getVertex(o);i=this.putCameraAtCenterOfPointCoordinateSystem(i),r.push(i);}return t.vertices=new g(r),t}putCameraAtCenterOfPointCoordinateSystem(e){return e=this.shiftWorldPointIntoCameraSpace(e),e=this.projectWorldPointOntoCameraAxis(e),e}shiftWorldPointIntoCameraSpace(e){return n.sub(e,this.#e.position)}projectWorldPointOntoCameraAxis(e){let t=n.dotProduct(e,this.#s),r=n.dotProduct(e,this.#i),o=n.dotProduct(e,this.#t);return new n(t,r,o)}copy(){return new l(this.#e.copy(),this.#t.copy(),this.#r,this.#o,this.#n)}pointAtPoint(e){if(!(e instanceof n))throw Error("point is not an instance of Vector");this.viewVector=n.unitVector(n.sub(e,this.#e.position));}};var W=class l{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}getLight(e){return this.#t[e]}getEntity(e){return this.#e[e]}copy(){return new l(this.#e.map(e=>e.copy()),this.#t.map(e=>e.copy()))}get numEntities(){return this.#e.length}get numLights(){return this.#t.length}setLightPos(e,t){y.hasPosition(this.#t[t])&&(this.#t[t].position=e);}set meshes(e){if(!Array.isArray(e))throw Error("meshes is not an array");this.meshes=e;}};var H=class{acceleration;currentTheta;constructor(e){this.currentTheta=0,this.acceleration=e;}rotateCameraAroundPointOnXZPlane(e,t,r,o){let i=e.copy(),s=n.add(t,new n(Math.sin(this.currentTheta)*r,0,Math.cos(this.currentTheta)*r));return this.currentTheta+=o,i.position=s,i.pointAtPoint(t),i}rotateCameraAroundPointAtYAbove(e,t,r,o,i){let s=e.copy();return s=this.rotateCameraAroundPointOnXZPlane(e,n.add(t,new n(0,o,0)),r,i),s.pointAtPoint(t),s}};var S=class{#e;#t;#r;#o;#n;#i=.01;constructor(e,t,r,o){this.#e=e,this.#t=t,this.#r=r,this.#o=o,this.#n=false;}update(e){let t=e.copy(),r=Math.abs(this.#t*Math.cos(this.#o));Math.cos(this.#o)<0?this.#n=true:this.#n=false;let o=new n(Math.cos(this.#r)*r,0,Math.sin(this.#r)*r),i=new n(0,this.#t*Math.sin(this.#o),0),s=n.add(this.#e,o,i);return e.position=s,e.pointAtPoint(this.#e),t}changeRadius(e){this.#t+=e;}mouseInputRotate(e,t,r,o){let i=(r-e)*this.#i,s=(o-t)*this.#i;this.#r+=i,this.#o+=(this.#n?-1:1)*s;}get radius(){return this.#t}};var I=class{camera;scene;renParam;constructor(e,t,r){this.scene=e,this.camera=t,this.renParam=r;}setSceneLightPos(e,t){this.scene.setLightPos(e,t);}getSceneInZOrder(){let e=[];for(let t=0;t<this.scene.numEntities;t++)e.push({type:"entity",ref:t,z:this.getCameraSpaceMesh(this.scene.getEntity(t)).calculateAverageZ()});for(let t=0;t<this.scene.numLights;t++){let r=this.scene.getLight(t);y.hasPosition(r)&&e.push({type:"light",ref:t,z:this.finalLightPosition(r).z});}return e.sort((t,r)=>r.z-t.z),e.filter(t=>t.z>=0)}graph(){this.preWork();let e=this.getSceneInZOrder();for(let t of e)t.type=="entity"&&this.graphEntity(this.scene.getEntity(t.ref)),t.type=="light"&&this.graphLight(this.scene.getLight(t.ref));this.postWork();}getColorOfTriangle(e,t,r){let o=t.computeCentroid(e.vertices),i=[],s=t.computeNormal(e.vertices);for(let a=0;a<this.scene.numLights;a++){let c=this.scene.getLight(a).calculateTriangleColor({trianglePosition:o,triangleNormalVector:s,triangleColor:r});i.push(c);}return ColorHandler.sumAndClamp(i)}getColorsOfTriangles(e,t){let r=[];for(let o=0;o<e.numTriangles;o++){let i=e.getTriangle(o),s=this.getColorOfTriangle(e,i,t[o]);r.push(s);}return r}finalLightPosition(e){let t=this.camera.putCameraAtCenterOfPointCoordinateSystem(e.position);return t=this.projectIndividualPoint(t),t=this.pointToCanvas(t),t}getCameraSpaceMesh(e){e=e.copy();let t=e.worldSpaceMesh;return this.camera.putCameraAtCenterOfMeshCoordinateSystem(t)}graphEntity(e){let t=e.worldSpaceMesh,r=e.triangleColors;e.isIndifferentToLight||(r=this.getColorsOfTriangles(t,r)),t.calculateTrianglesNormalVectors();let o=t.mapTrianglesToAnyObject(r);t=this.getCameraSpaceMesh(e),!this.renParam.isWindingOrderBackFaceCulling&&this.renParam.doBackFaceCulling&&(t=this.backFaceCulling_Normal(t));let i;if(i=t.calculateTrianglesNormalVectors(),t=this.applyProjection(t),this.isAnyMeshPointBehindCamera(t))return;if(this.renParam.isWindingOrderBackFaceCulling&&this.renParam.doBackFaceCulling){let h=t.mapTrianglesToAnyObject(i);t=this.backFaceCulling_WindingOrder(t),i=t.findAnyObjectFromMap(h);}let s=t.findAnyObjectFromMap(o),a=t;t=this.meshToCanvas(t),this.renParam.doVertices&&this.graphVertices(t),this.renParam.doTriangles&&this.graphTriangles(t,s),this.renParam.doNormalVectors&&this.graphNormalVectors(a,i,this.renParam.normalVectorLength);}isAnyMeshPointBehindCamera(e){for(let t=0;t<e.numPoints;t++)if(e.getVertex(t).z===-1/0)return  true;return  false}generateMeshWithAppropriateColorsWithOnlyVisiblePartsOfTriangles(e,t){let r=[],o=e.copy(),i=new Map,s=this.getHiddenPoints(o);for(let c=0;c<s.length;c++)i.set(s[c],true);let a=[],h=[];for(let c=0;c<o.numTriangles;c++){let u=e.getTriangle(c),p=this.whichPointsInMap(o,u,i),m=p.length;m!==3&&(m===1?h.push({triangle:u,vector:p[0]}):m===2?a.push({triangle:u,vectors:p}):m===0&&r.push(u),r.push(u));}o.triangles=r;for(let c=0;c<a.length;c++){let u=this.generateNewMeshWithAppropriateColorsWithNewVisibleTriangleFromOneTriangleWithTwoHiddenVertices(a[c].triangle,a[c].vectors,o,t);o=u.mesh,t=u.colorMap;}for(let c=0;c<h.length;c++){let u=this.generateNewMeshWithAppropriateColorsWithTwoNewVisibleTrianglesFromOneTriangleWithHiddenVertex(h[c].triangle,h[c].vector,o,t);o=u.mesh,t=u.colorMap;}return o}generateNewMeshWithAppropriateColorsWithNewVisibleTriangleFromOneTriangleWithTwoHiddenVertices(e,t,r,o){if(t.length!==2)throw Error("hiddenVertices.length !== 2");let i=-1/0;for(let f=0;f<3;f++){let w=e.getVerticeReference(f),x=r.getVertex(w);for(let L=0;L<t.length;L++)t[L].equals(x)||(i=w);}if(i===-1/0)throw Error("Fatal error, malformed inputs likely the case");let s=this.findPointBetweenTwoPointsAtZeroZ(t[0],r.getVertex(i)),a=this.findPointBetweenTwoPointsAtZeroZ(t[1],r.getVertex(i)),h=r.vertices;h.addVertex(s);let c=h.numPoints-1;h.addVertex(a);let u=h.numPoints-1,p=new V([c,u,i]),m=r.triangles;m.push(p);let d=p.getDistinctIdentifier(),b=o.get(e.getDistinctIdentifier());return b!=null?o.set(d,b):o.set(d,new ColorHandler(255,255,255)),{mesh:new P(r.vertices,m),colorMap:o}}generateNewMeshWithAppropriateColorsWithTwoNewVisibleTrianglesFromOneTriangleWithHiddenVertex(e,t,r,o){let i=[];console.log(`start-------
`),console.log(t);for(let f=0;f<3;f++){let w=e.getVerticeReference(f),x=r.getVertex(w);console.log(x),!t.equals(x)&&i.push(w);}if(i.length!==2)throw Error(" fatal error, visible vertice references.length !== 2");let s=this.findPointBetweenTwoPointsAtZeroZ(t,r.getVertex(i[0])),a=this.findPointBetweenTwoPointsAtZeroZ(t,r.getVertex(i[1])),h=r.vertices;h.addVertex(s);let c=h.numPoints-1;h.addVertex(a);let u=h.numPoints-1,p=new V([c,u,i[0]]),m=r.triangles;m.push(p);let d=p.getDistinctIdentifier(),b=o.get(e.getDistinctIdentifier());return b!=null?o.set(d,b):o.set(d,new ColorHandler(255,255,255)),p=new V([u,i[1],i[0]]),m.push(p),d=p.getDistinctIdentifier(),b=o.get(e.getDistinctIdentifier()),b!=null?o.set(d,b):o.set(d,new ColorHandler(255,255,255)),{mesh:new P(r.vertices,m),colorMap:o}}findPointBetweenTwoPointsAtZeroZ(e,t){let r=e.x+(t.x-e.x)*(-e.z/(t.z-e.z)),o=e.y+(t.y-e.y)*(-e.z/(t.z-e.z)),i=0;return new n(r,o,i)}whichPointsInMap(e,t,r){let o=[];for(let i=0;i<3;i++){let s=t.getVerticeReference(i),a=e.getVertex(s);r.has(a)&&o.push(a);}return o}getHiddenPoints(e){let t=[];for(let r=0;r<e.numPoints;r++){let o=e.getVertex(r);o.z===-1/0&&t.push(o);}return t}backFaceCulling_Normal(e){let t=new n(0,0,1),o=e.copy(),i=[],s=o.calculateTrianglesNormalVectors();for(let a=0;a<e.numTriangles;a++){let h;this.renParam.isPerspective?h=n.sub(s[a].position,new n(0,0,0)).isDotProductLEThanX(s[a].direction,0):h=t.isDotProductLEThanX(s[a].direction,0),h&&i.push(e.getTriangle(a));}return o.triangles=i,o}backFaceCulling_WindingOrder(e){let t=e.copy(),r=[];for(let o=0;o<t.numTriangles;o++){let i=t.getTriangle(o),s=t.getVertex(i.getVerticeReference(0)),a=t.getVertex(i.getVerticeReference(1)),h=t.getVertex(i.getVerticeReference(2)),c=n.sub(a,s),u=n.sub(h,s);c.x*u.y-u.x*c.y>0&&r.push(i);}return t.triangles=r,t}orthographicProjectIndividualVector(e){this.camera.focalDistance;return e.z<0&&(-1/0),new n(e.x,e.y,this.camera.focalDistance)}perspectiveProjectIndividualVector(e){let t=this.camera.focalDistance/e.z,r=e.x*t,o=e.y*t,i=e.z;return e.z<0&&(i=-1/0),new n(r,o,i)}orthographicProjectNormalVectorIntoLine(e,t){let r=this.orthographicProjectIndividualVector(e.position),o=this.orthographicProjectIndividualVector(n.add(n.scalarMult(e.direction,t),e.position));return new T(r,o)}perspectiveProjectNormalVectorIntoLine(e,t){let r=this.perspectiveProjectIndividualVector(e.position),o=this.perspectiveProjectIndividualVector(n.add(n.scalarMult(e.direction,t),e.position));return new T(r,o)}projectNormalVectorsIntoLines(e,t){let r=[];for(let o of e){let i=this.renParam.isPerspective?this.perspectiveProjectNormalVectorIntoLine(o,t):this.orthographicProjectNormalVectorIntoLine(o,t);i.p1.z!=-1/0&&i.p2.z!=-1/0&&r.push(i);}return r}applyProjection(e){let t=e.copy(),r=[];for(let i=0;i<t.numPoints;i++){let s,a=t.getVertex(i);s=this.projectIndividualPoint(a),r.push(s);}let o=new g(r);return t.vertices=o,t}projectIndividualPoint(e){return this.renParam.isPerspective?e=this.perspectiveProjectIndividualVector(e):e=this.orthographicProjectIndividualVector(e),e}};var k=class extends I{#e;#t;constructor(e,t,r,o,i){super(e,r,o),i.createCanvas(t.x,t.y),this.#t=i,this.#e=i.createGraphics(t.x,t.y);}preWork(){this.#e.clear(),this.#e.background(0);}postWork(){this.#t.image(this.#e,0,0);}meshToCanvas(e){let t=e.copy(),r=[];for(let o=0;o<t.numPoints;o++)r.push(this.pointToCanvas(e.getVertex(o)));return e.vertices=new g(r),e}pointToCanvas(e){return this.calculateCanvasPos(e)}calculateCanvasPos(e){return n.add(new n(this.#e.width/2,this.#e.height/2,0),e)}linesToCanvas(e){let t=[];for(let r of e)t.push(new T(this.calculateCanvasPos(r.p1),this.calculateCanvasPos(r.p2)));return t}graphVertices(e){for(let t=0;t<e.numPoints;t++)this.graphVertex(e.getVertex(t),new ColorHandler(0,0,0),3);}graphLight(e){let t=this.finalLightPosition(e);this.graphVertex_noStroke(t,e.color.multiplyByNumber(e.brightness),30);}graphVertex_noStroke(e,t,r){this.#e.noStroke(),this.#e.fill(this.convertColorHandlerToP5(t)),this.graphVertex(e,t,r);}graphVertex(e,t,r){this.#e.circle(e.x,e.y,r);}graphTriangle(e,t){let r=e.getVertex(t.getVerticeReference(0)),o=e.getVertex(t.getVerticeReference(1)),i=e.getVertex(t.getVerticeReference(2));this.#e.strokeJoin(this.#t.ROUND),this.#e.stroke(this.#t.color(0)),this.#e.triangle(r.x,r.y,o.x,o.y,i.x,i.y);}graphTriangles(e,t){for(let r=0;r<e.numTriangles;r++){let o=e.getTriangle(r);this.#e.fill(this.convertColorHandlerToP5(t[r])),this.graphTriangle(e,o);}}graphLines(e,t){for(let r of e)this.graphLine(r,t);}graphLine(e,t){this.graphBetweenTwoPoints(e.p1,e.p2,t);}graphBetweenTwoPoints(e,t,r){this.#e.stroke(r),this.#e.line(e.x,e.y,t.x,t.y);}convertColorHandlerToP5(e){return this.#t.color(e.red,e.green,e.blue)}graphNormalVectors(e,t,r){let o=this.projectNormalVectorsIntoLines(t,r),i=this.linesToCanvas(o);this.graphLines(i,this.#t.color(255));}copy(){}};var D=class{#e;#t;#r;#o;#n;#i;#s;#a;#l;#c;#h;#u;constructor({doBackFaceCulling:e=true,doOutline:t=true,doFill:r=true,doVertices:o=false,doShadingWithLighting:i=true,lineWidth:s=1,pointRadius:a=3,isPerspective:h=true,doTriangles:c=true,isWindingOrderBackFaceCulling:u=true,doNormalVectors:p=false,normalVectorLength:m=30}={}){this.#e=e,this.#t=t,this.#r=r,this.#o=o,this.#n=i,this.#i=s,this.#s=a,this.#a=h,this.#l=c,this.#c=u,this.#h=p,this.#u=m;}get doBackFaceCulling(){return this.#e}get doOutline(){return this.#t}get doFill(){return this.#r}get doVertices(){return this.#o}get doShadingWithLighting(){return this.#n}get lineWidth(){return this.#i}get pointRadius(){return this.#s}get isPerspective(){return this.#a}get doTriangles(){return this.#l}get isWindingOrderBackFaceCulling(){return this.#c}get doNormalVectors(){return this.#h}get normalVectorLength(){return this.#u}set doBackFaceCulling(e){if(typeof e!="boolean")throw new TypeError("doBackFaceCulling must be boolean");this.#e=e;}set doOutline(e){if(typeof e!="boolean")throw new TypeError("doOutline must be boolean");this.#t=e;}set doFill(e){if(typeof e!="boolean")throw new TypeError("doFill must be boolean");this.#r=e;}set doVertices(e){if(typeof e!="boolean")throw new TypeError("doVertices must be boolean");this.#o=e;}set doShadingWithLighting(e){if(typeof e!="boolean")throw new TypeError("doShadingWithLighting must be boolean");this.#n=e;}set lineWidth(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("lineWidth must be a positive finite number");this.#i=e;}set pointRadius(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("pointRadius must be a positive finite number");this.#s=e;}set isPerspective(e){if(typeof e!="boolean")throw new TypeError("isPerspective must be boolean");this.#a=e;}set doTriangles(e){if(typeof e!="boolean")throw new TypeError("doTriangles must be boolean");this.#l=e;}set isWindingOrderBackFaceCulling(e){if(typeof e!="boolean")throw new TypeError("isWindingOrderBackFaceCulling must be boolean");this.#c=e;}set doNormalVectors(e){if(typeof e!="boolean")throw new TypeError("doNormalVectors must be boolean");this.#h=e;}set normalVectorLength(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("normalVectorLength must be a positive finite number");this.#u=e;}};export{R as Camera,H as CameraMover,S as CameraSpotTracker,A as DirectionalLight,O as Entity,v as MeshGenerator,B as PhysicsBody,E as PointLight,D as RenderParameters,I as Renderer,W as Scene,n as Vector,k as p5Renderer};