var geometry=(function(exports){'use strict';var p=class{static getIndexOfArrayMax(n){if(!Array.isArray(n))throw Error("arrayOfNumbers is not an array");if(n.length==0)throw Error("arrayOfNumbers contains no elements");let e=0,t=n[0];for(let r=0;r<n.length;r++){let i=n[r];i>t&&(t=i,e=r);}return e}static isMixedUpArraysEqual(n,e){if(n.length!==e.length)return  false;n=[...n],e=[...e];for(let t=n.length-1;t>=0;t--)for(let r=e.length-1;r>=0;r--)n[t]===e[r]&&(n.splice(t,1),e.splice(r,1));return n.length==0&&e.length==0}static isThereValueGreaterThanN(n,e){for(let t of n)if(t>e)return  true;return  false}static combineArrays(n){let e=[];for(let t of n)for(let r of t)e.push(r);return e}static arrayOfIndices(n){let e=[];for(let t=0;t<n;t++)e.push(t);return e}static addToMap(n,e,t){n.has(e)||n.set(e,[]);n.get(e).push(t);return n}static incrementMap(n,e){if(!n.has(e))throw new Error("Supplied map is bad");n.set(e,n.get(e)+1);}static isInArray(n,e){for(let t=0;t<n.length;t++)if(n[t]===e)return  true;return  false}static getCounterClockwiseMove(n,e){if(!n.has(e))throw Error("Key not found");let t=[...n.get(e)];if(t.length==1)return e=t[0],e;for(let r=t.length-1;r>=0;r--)this.doesMoveExistElsewhere(n,e,t[r])&&t.splice(r,1);return t[0]}static doesMoveExistElsewhere(n,e,t){if(n.has(e)==false)throw new Error("Could not find node");return this.isInArray(n.get(t),e)}static doesKeyHaveSpecificValue(n,e,t){if(!n.has(e))throw Error("Key not found in hash graph");let r=n.get(e);for(let i=0;i<r.length;i++)if(r[i]===t)return  true;return  false}static findNodeThatHasSpecificNodeAsConnection(n,e,t,r){if(!n.has(e))throw Error("Key not found in hash graph");let i=n.get(e);for(let o=0;o<i.length;o++)if(i[o]!==r&&this.doesKeyHaveSpecificValue(n,i[o],t))return i[o];return  -1}static runSearchMovementAroundCenter(n,e,t,r,i){let o=100,l=1,a=t,c=r,h=e;for(;a!=h;){if(l++,l>o||a==-1)return  false;let u=a;a=this.findNodeThatHasSpecificNodeAsConnection(n,a,c,i),i=u;}return  true}static isNodeSurroundedByNodes(n,e){if(!n.has(e))throw Error("Key not found in hash graph");let t=n.get(e),o=[];for(let l=0;l<t.length;l++){let a=t[l],c=a,h=this.findNodeThatHasSpecificNodeAsConnection(n,a,e,c),u=this.runSearchMovementAroundCenter(n,a,h,e,c);o.push(u);}return this.isInArray(o,true)}static getOutsideNode(n){for(let e of n.keys())if(!this.isNodeSurroundedByNodes(n,e))return e;return  -1}static randomIntBetween(n,e){let t=Math.round(Math.random()*(e-n));return n+t}static multiplyArray(n,e){let t=[];for(let r of n)t.push(r*e);return t}static divideArray(n,e){if(e==0)throw new Error("Divisor is 0, critical failure, cannot divide by zero!");let t=[];for(let r of n)t.push(r/e);return t}static elementWiseMultiplication(n,e){if(n.length!=e.length)throw new Error("Array lengths are different!");let t=[];for(let r=0;r<n.length;r++)t.push(n[r]*e[r]);return t}static randomP5Color(){return "rgb("+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+")"}static getNodesOnOutsideOfCounterClockwiseGraph(n,e){e==null&&(e=15);let t=1;new Map(n);let i=this.getOutsideNode(n),o=this.getCounterClockwiseMove(n,i),l=[];for(;t<e&&o!=i;){t++;let a=this.getCounterClockwiseMove(n,o);l.push(o),o=a;}return l.push(o),l}static removeIndicesFromArray(n,e){n=[...n];let t;for(let r=e.length-1;r>=0;r--)t=e[r],n.splice(t,1);return n}static clampNumber(n,e,t){return n=n>t?t:n,n=n<e?e:n,n}static assertBool(n,e){if(typeof n!="boolean")throw new TypeError(e)}static assertNum(n,e){if(typeof n!="number"||Number.isNaN(n))throw new TypeError(e)}};p.noDuplicates=n=>[...new Set(n)];var V=class f{#e;#t;#r;#i;static{this.BLACK=new f(0,0,0);}static{this.WHITE=new f(255,255,255);}constructor(e,t,r){if(!Number.isFinite(e))throw Error("red must be a finite number");if(!Number.isFinite(t))throw Error("green must be a finite number");if(!Number.isFinite(r))throw Error("blue must be a finite number");this.#e=Math.min(Math.max(0,e),255),this.#t=Math.min(Math.max(0,t),255),this.#r=Math.min(Math.max(0,r),255),this.#i=[e,t,r];}static random(){return new f(p.randomIntBetween(0,255),p.randomIntBetween(0,255),p.randomIntBetween(0,255))}get red(){return this.#e}get green(){return this.#t}get blue(){return this.#r}setRed(e){this.#e=e;}setGreen(e){this.#t=e;}setBlue(e){this.#r=e;}multiplyByNumber(e){return new f(this.#e*e,this.#t*e,this.#r*e)}static randomColorsBetween(e,t,r){let i=[];for(let o=0;o<e;o++)i.push(this.randomColorBetween(t,r));return i}static randomColorBetween(e,t){return new f(p.randomIntBetween(e.red,t.red),p.randomIntBetween(e.green,t.green),p.randomIntBetween(e.blue,t.blue))}static randomColorAtWithGeneralRadius(e,t){return this.randomColorAtWithRadius(e,t,t,t)}static randomColorAtWithRadius(e,t,r,i){let o=new f(e.red-t,e.green-r,e.blue-i),l=new f(e.red+t,e.green+r,e.blue+i);return this.randomColorBetween(o,l)}addNumber(e){if(!Number.isFinite(e))throw Error("number is not finite");return new f(this.#e+e,this.#t+e,this.#r+e)}addColor(e){return new f(this.#e+e.red,this.#t+e.green,this.#r+e.blue)}addInto(e){this.#e+=e.red,this.#t+=e.green,this.#r+=e.blue;}copy(){return new f(this.#e,this.#t,this.#r)}clampColor(){let e=this.#e>255?255:this.#e;e=this.#e<0?0:this.#e;let t=this.#t>255?255:this.#t;t=this.#t<0?0:this.#t;let r=this.#r>255?255:this.#r;return r=this.#r<0?0:this.#r,new f(e,t,r)}static sumAndClamp(e){let t=new f(0,0,0);for(let r of e)t=r.addColor(t);return new f(p.clampNumber(t.red,0,255),p.clampNumber(t.green,0,255),p.clampNumber(t.blue,0,255))}elementWiseMultiplication(e){return new f(e.red*this.#e,e.green*this.#t,e.blue*this.#r)}};var w=class{#e;#t;constructor(e,t){if(e==null)throw Error("Color is not defined");if(t==null)throw Error("Brightness is not defined");if(!Number.isFinite(t))throw Error("Brightness is not finite");e=e.clampColor(),this.#e=e,this.#t=t;}calculateObservedColor(e,t){let r=this.#t/(t**2+.010000000000000002),o=this.#e.multiplyByNumber(r).multiplyByNumber(1/255),a=e.multiplyByNumber(1/255).elementWiseMultiplication(o);return a=a.multiplyByNumber(255),a}get color(){return this.#e.copy()}get brightness(){return this.#t}set brightness(e){e!=null&&Number.isFinite(e)&&(e=Math.max(0,e),this.#t=this.clampBrightness(e));}clampBrightness(e){return e}static hasPosition(e){return "position"in e}};var s=class n{#e;#t;#r;static ZERO=new n(0,0,0);constructor(e,t,r){this.#e=e,this.#t=t,this.#r=r;}get x(){return this.#e}get y(){return this.#t}get z(){return this.#r}static zero(){return new this(0,0,0)}set z(e){if(!Number.isFinite(e))throw Error("n is not finite");this.#r=e;}static isVectorEqual(e,t){if(!(e instanceof n))throw Error("v1 must be a vector");if(!(t instanceof n))throw Error("v2 must be a vector");return e.x===t.x&&e.y===t.y&&t.z===t.z}static unitVector(e){if(!(e instanceof n))throw Error("v must be a vector");let t=e.magnitude();return new this(e.x/t,e.y/t,e.z/t)}static upVector(){return new this(0,1,0)}static downVector(){return new this(0,-1,0)}static generateVectorInSphere(e){e=Math.random()*e*e*e,e=Math.cbrt(e);let t=2,r=0,i=0,o=0;for(;t>1;)r=Math.random()*2-1,i=Math.random()*2-1,o=Math.random()*2-1,t=r*r+i*i+o*o;return new n(r*e,i*e,o*e)}equals(e){return e.x==this.#e&&e.y==this.#t&&e.z==this.#r}static magnitude(e){if(!(e instanceof n))throw Error("p1 must be a vector");return e.magnitude()}magnitude(){return Math.hypot(this.x,this.y,this.z)}static distanceBetweenVectors(e,t){if(!(e instanceof n))throw Error("v1 must be a vector");if(!(t instanceof n))throw Error("v2 must be a vector");return Math.hypot(e.x-t.x,e.y-t.y,e.z-t.z)}static lerp(e,t,r){if(!Number.isFinite(e))throw Error("p1 is not a finite number");if(!Number.isFinite(t))throw Error("p2 is not a finite number");if(!Number.isFinite(r))throw Error("t is not a finite number");return (t-e)*r+e}static lerpVector(e,t,r){return new this(this.lerp(e.x,t.x,r),this.lerp(e.y,t.y,r),this.lerp(e.z,t.z,r))}static crossProduct(e,t){return new this(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}static dotProduct(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static sub(e,t){return new this(e.x-t.x,e.y-t.y,e.z-t.z)}static add(...e){let t=0,r=0,i=0;for(let o of e)t+=o.x,r+=o.y,i+=o.z;return new n(t,r,i)}static scalarMult(e,t){return new this(e.x*t,e.y*t,e.z*t)}isDotProductLEThanX(e,t){return n.dotProduct(this,e)<=t}copy(){return new n(this.#e,this.#t,this.#r)}static oppositeVector(e){return this.scalarMult(e,-1)}};var L=class n extends w{#e;#t;constructor(e,t,r,i=70){super(e,t),this.#e=r,this.#t=i;}copy(){return new n(this.color,this.brightness,this.#e)}calculateTriangleColor(e){let t=s.unitVector(s.sub(this.#e,e.trianglePosition)),r=Math.max(0,s.dotProduct(t,e.triangleNormalVector));if(r<=0)return new V(0,0,0);let i=this.calculateObservedColor(e.triangleColor,e.distance);return i=i.multiplyByNumber(r),i}get radius(){return this.#t}set radius(e){this.#t=e;}get position(){return this.#e}set position(e){this.#e=e;}};var A=class n extends w{#e;constructor(e,t,r){super(e,t),this.#e=r,this.direction=r;}clampBrightness(e){return e==null||!Number.isFinite(e)?1:(e=Math.max(0,e),e=Math.min(e,1),e)}set direction(e){this.#e=s.unitVector(e);}get direction(){return this.#e.copy()}copy(){return new n(this.color.copy(),this.brightness,this.#e.copy())}calculateTriangleColor(e){let t=s.dotProduct(this.#e,e.triangleNormalVector);if(t<=0)return new V(0,0,0);let r=this.calculateObservedColor(e.triangleColor,1);return r=r.multiplyByNumber(t),r}};var v=class n{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}worldPositionOfDirection(){return s.add(this.#e,this.#t)}copy(){return new n(this.#e.copy(),this.#t.copy())}get position(){return this.#e}get direction(){return this.#t}};var T=class n{#e;constructor(e){this.#e=e;}logReferences(){console.log(this.#e[0],this.#e[1],this.#e[2]);}doesUpspaceContain(e,t){let r=s.sub(e.getVertex(t),e.getVertex(this.#e[0])),i=this.computeNormal(e),o=s.dotProduct(r,i);return !(Math.abs(o)<1e-5||o<0)}computeCentroid(e){let t=e.getVertex(this.#e[0]),r=e.getVertex(this.#e[1]),i=e.getVertex(this.#e[2]),o=s.lerpVector(t,r,.5);return s.lerpVector(o,i,.33333)}static isDotProductLEThanX(e,t,r){throw Error("function has been moved to the vector class.")}computeNormal(e){let t=s.sub(e.getVertex(this.#e[0]),e.getVertex(this.#e[1])),r=s.sub(e.getVertex(this.#e[2]),e.getVertex(this.#e[0])),i=s.crossProduct(t,r);return s.unitVector(i)}distanceTo(e,t){let r=this.computeNormal(e),i=e.getVertex(this.#e[0]),o=-(r.x*i.x+r.y*i.y+r.z*i.z);return Math.abs(r.x*t.x+r.y*t.y+r.z*t.z+o)/Math.sqrt(r.x**2+r.y**2+r.z**2)}getFarthestPoint(e,t){if(!(t.length>0))throw Error("pointIndices must contain at least one entry");let r=t[0],i=0;for(let o of t){let l=e.getVertex(o),a=this.distanceTo(e,l);a>i&&(i=a,r=o);}return r}flipNormal(){return new n([this.#e[2],this.#e[1],this.#e[0]])}getVerticeReference(e){return this.#e[e]}static addPointsFromTrianglesToMap(e,t){for(let r=0;r<t.length;r++){for(let i=0;i<2;i++)p.addToMap(e,t[r].getVerticeReference(i),t[r].getVerticeReference(i+1));p.addToMap(e,t[r].getVerticeReference(2),t[r].getVerticeReference(0));}}static createPyramidFromBoundaryPoints(e,t){let r=[];for(let i=0;i<e.length-1;i++){let o=new this([t,e[i],e[i+1]]);r.push(o);}return r.push(new this([t,e[e.length-1],e[0]])),r}copy(){let e=[];for(let t of this.#e)e.push(t);return new n(e)}getDistinctIdentifier(){return this.#e[0].toString()+this.#e[1].toString()+this.#e[2].toString()}calculateTriangleNormalVector(e){let t=this.computeCentroid(e),r=this.computeNormal(e);return new v(t,r)}};var C=class{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}get p1(){return this.#e}get p2(){return this.#t}isEqual(e){return this===e||this.#e===e.p1&&this.#t===e.p2||this.#e===e.p2&&this.#t==e.p1}distanceToPoint(e){let t=s.sub(e,this.#e),r=s.sub(this.#t,this.#e);return s.magnitude(s.crossProduct(t,r))/s.magnitude(r)}};var g=class n{array;constructor(e){this.array=e,e==null&&(this.array=[]);}getVertex(e){return this.array[e]}generateRandomPointsInSphere(e,t){this.array=[];for(let r=0;r<t;r++)this.array.push(s.generateVectorInSphere(e));}getTrianglesUpspace(e,t){let r=[];for(let i of t)i==e.getVerticeReference(0)||i==e.getVerticeReference(1)||i==e.getVerticeReference(2)||e.doesUpspaceContain(this,i)&&r.push(i);return r}getTrianglesWithPointInUpspace(e,t){let r=[],i;for(let o=0;o<e.length;o++)i=e[o],i.doesUpspaceContain(this,t)&&r.push(i);return r}getTriangleIndicesWithPointInUpspace(e,t){let r=[],i;for(let o=0;o<e.length;o++)i=e[o],i.doesUpspaceContain(this,t)&&r.push(o);return r}getTrianglesUpspaces(e,t){let r=[];for(let i of e)r.push(this.getTrianglesUpspace(i,t));return r=p.combineArrays(r),p.noDuplicates(r)}getTrianglesUpspaces_Fast(e,t){let r=[];for(let i of e){let o=[];for(let l of t){if(l==i.getVerticeReference(0)||l==i.getVerticeReference(1)||l==i.getVerticeReference(2))continue;let a=this.getVertex(l),c=this.getVertex(i.getVerticeReference(0)),h=a.x-c.x,u=a.y-c.y,m=a.z-c.z,d=i.computeNormal(this);h*d.x+u*d.y+m*d.z;i.doesUpspaceContain(this,l)&&o.push(l);}r.push(o);}return r=p.combineArrays(r),p.noDuplicates(r)}getAverageDistanceBetweenPointsAndTriangles(e,t){let r=[];for(let i of t){let o=0;for(let a of e)o+=a.distanceTo(this,this.getVertex(i));let l=o/e.length;r.push(l);}return r}getFarthestPointFromTriangles(e,t){let r=this.getFarthestPointsFromTriangles(e,t),i=this.getAverageDistanceBetweenPointsAndTriangles(e,r),o=p.getIndexOfArrayMax(i);if(o==null)throw Error("Bad error");return r[o]}getFarthestPointFromTriangles_Fast(e,t){let r=t[0],i=-1/0;for(let o of t){let l=0,a=this.getVertex(o);for(let c of e){let h=c.computeNormal(this),u=this.getVertex(c.getVerticeReference(0)),m=-(h.x*u.x+h.y*u.y+h.z*u.z);l+=(h.x*a.x+h.y*a.y+h.z*a.z+m)/(h.x**2+h.y**2+h.z**2);}l>i&&(i=l,r=o);}return r}getFarthestPointsFromTriangles(e,t){let r=[];for(let o of e)r.push(o.getFarthestPoint(this,t));return r}getFarthestVectorFromVector(e){let t=0,i=-1,o=this.array[e];for(let l=0;l<this.array.length;l++){let a=s.distanceBetweenVectors(this.array[l],o);a>t&&(t=a,this.array[l],i=l);}if(i==-1)throw Error("no farthest distance point found at all");return i}calculateLargestTriangleFromField(){let e=this.lowestVectorInField(),t=this.getFarthestVectorFromVector(e),r=new C(this.array[e],this.array[t]),i=this.calculateFarthestPoint(r);return new T([e,t,i])}calculateFarthestPoint(e){let t=0,i=-1;for(let o=0;o<this.array.length;o++){if(s.isVectorEqual(this.array[o],e.p1)||s.isVectorEqual(this.array[o],e.p2))continue;let a=e.distanceToPoint(this.array[o]);t<a&&(this.array[o],t=a,i=o);}if(i==-1)throw Error("no farthest point found");return i}lowestVectorInField(){if(this.array.length==0)throw Error("array length is 0");let e=this.array[0],t=0;for(let r=0;r<this.array.length;r++)e.x>this.array[r].x&&(e=this.array[r],t=r,r=0);return t}moveEntireField(e){let t=[];for(let r=0;r<this.array.length;r++)t.push(s.add(this.array[r],e));return new n(t)}copy(){let e=[];for(let t of this.array)e.push(new s(t.x,t.y,t.z));return new n(e)}addVertex(e){let t=[];for(let r of this.array)t.push(new s(r.x,r.y,r.z));return t.push(e),new n(t)}get numPoints(){return this.array.length}};var x=class n{#e;#t;constructor(e,t){if(!(e instanceof g))throw Error("vertices is not an instance of Field");if(!Array.isArray(t))throw Error("triangles is not an array");this.#e=e,this.#t=t,e==null&&(this.#e=new g([])),t==null&&(this.#t=[]);}calculateAverageZ(){let e=0;for(let t=0;t<this.#e.numPoints;t++)e+=this.#e.getVertex(t).z;return e/this.#e.numPoints}calculateTrianglesNormalVectors(){let e=[];for(let t of this.#t)e.push(t.calculateTriangleNormalVector(this.#e));return e}mapTrianglesToAnyObject(e){if(this.numTriangles!==e.length)throw new Error("number of triangles does not equal number of objects");let t=new Map;for(let r=0;r<this.numTriangles;r++)t.set(this.getTriangle(r).getDistinctIdentifier(),e[r]);return t}findAnyObjectFromMap(e){let t=[];for(let r=0;r<this.numTriangles;r++){let i=this.getTriangle(r).getDistinctIdentifier(),o=e.get(i);o!==void 0&&t.push(o);}return t}copy(){let e=this.copyTriangles();return new n(this.#e.copy(),e)}copyTriangles(){let e=[];for(let t of this.#t)e.push(t.copy());return e}get vertices(){return this.#e.copy()}get triangles(){return this.copyTriangles()}get numPoints(){return this.#e.numPoints}get numTriangles(){return this.#t.length}get triangleCentroids(){let e=[];for(let t=0;t<this.#t.length;t++){let r=this.#t[t];e.push(r.computeCentroid(this.vertices));}return e}get triangleNormalVectors(){let e=[];for(let t=0;t<this.#t.length;t++){let r=this.#t[t];e.push(r.computeNormal(this.vertices));}return e}getVertex(e){if(!Number.isSafeInteger(e))throw Error("index is not a safe integer");return this.#e.getVertex(e)}getTriangle(e){if(!Number.isSafeInteger(e))throw Error("index is not a safe integer");return this.#t[e]}set vertices(e){if(!(e instanceof g))throw Error("vertices must be an instance of Field");this.#e=e;}set triangles(e){if(!Array.isArray(e))throw Error("triangles is not an array");this.#t=e;}};var F=class n{static convexHullIterativeProcess(e,t,r){t=[...t];let i=e.getTrianglesUpspaces_Fast(t,r),o=i[0];if(i.length==1)o=i[0];else {if(i.length==0)return [];o=e.getFarthestPointFromTriangles_Fast(t,i);}let l=e.getTriangleIndicesWithPointInUpspace(t,o),a=e.getTrianglesWithPointInUpspace(t,o),c=new Map;T.addPointsFromTrianglesToMap(c,a);let h=p.getNodesOnOutsideOfCounterClockwiseGraph(c,1e5),u=T.createPyramidFromBoundaryPoints(h,o);return t=p.removeIndicesFromArray(t,l),t=n.addTrianglesToTrianglesArray(t,u),t}static addTrianglesToTrianglesArray(e,t){let r=[];e.forEach(i=>{r.push(i.copy());});for(let i of t)r.push(i);return r}static generateConvexMesh(e,t){let o;o=[e.calculateLargestTriangleFromField()],o.push(o[0].flipNormal());let l=p.arrayOfIndices(e.numPoints);o=this.convexHullIterativeProcess(e,o,l);for(let a=0;a<t;a++){let c=this.convexHullIterativeProcess(e,o,l);if(c.length==0)return new x(e,o);o=c;}return new x(e,o)}static generateRandomConvexMesh(e,t){let r=new g([]);return r.generateRandomPointsInSphere(e,t),this.generateConvexMesh(r,310)}};var B=class n{#e;#t;#r;#i;constructor(e,t,r,i){this.#e=e,e instanceof s||(this.#e=new s(0,0,0)),this.#t=t,t instanceof s||(this.#t=new s(0,0,0)),this.#r=r,r instanceof s||(this.#r=new s(0,0,0)),this.#i=i,i==null&&(this.#i=.01);}update(e){this.#e=s.add(this.#e,s.scalarMult(this.#t,e)),this.#t=s.add(this.#t,s.scalarMult(this.#r,e)),this.#t=s.scalarMult(this.#t,1-this.#i);}get position(){return this.#e.copy()}get velocity(){return this.#t.copy()}get acceleration(){return this.#r.copy()}set position(e){if(!(e instanceof s))throw Error("Position input is not of type Vector");this.#e=e;}set velocity(e){if(!(e instanceof s))throw Error("Velocity input is not of type Vector");this.#t=e;}set acceleration(e){if(!(e instanceof s))throw Error("Acceleration input is not of type Vector");this.#r=e;}copy(){return new n(this.#e.copy(),this.#t.copy(),this.#r.copy(),this.#i)}};var z=class n{#e;#t;#r;#i;constructor(e,t,r,i){this.#e=e,this.#t=t,this.#r=r,this.#i=i;}static randomConvexEntityWithColors(e,t,r,i,o,l){let a=F.generateRandomConvexMesh(e,t),c=V.randomColorsBetween(a.numTriangles,i,o);return new this(a,r,c,l)}copy(){let e=[];for(let t of this.#r)e.push(t.copy());return new n(this.#e.copy(),this.#t.copy(),e,this.#i)}get triangleColors(){let e=[];for(let t of this.#r)e.push(t.copy());return e}get worldSpaceMesh(){let e=this.#e.copy(),t=[];for(let i=0;i<e.numPoints;i++)t.push(s.add(e.getVertex(i),this.#t.position));let r=new g(t);return e.vertices=r,e}set physicsBody(e){this.#t=e;}get physicsBody(){return this.#t.copy()}get mesh(){return this.#e.copy()}get isIndifferentToLight(){return this.#i}};var R=class n{#e;#t;#r;#i;#o;#n;#a;constructor(e,t,r,i,o){this.#e=e,this.#t=s.unitVector(t),this.#r=r,this.#i=i,this.#o=o,this.#n=new s(0,1,0),this.#a=s.unitVector(s.crossProduct(t,this.#n));}get focalDistance(){return this.#i}get position(){return this.#e.position}set position(e){if(!(e instanceof s))throw Error("position is not an instance of Vector");this.#e.position=e;}set viewVector(e){this.#t=e,this.#n=new s(0,1,0),(e.equals(s.upVector())||e.equals(s.downVector()))&&(this.#n=new s(1,0,0)),this.#a=s.unitVector(s.crossProduct(e,this.#n)),this.#n=s.unitVector(s.crossProduct(e,this.#a));}putCameraAtCenterOfMeshCoordinateSystem(e){let t=e.copy(),r=[];for(let i=0;i<e.numPoints;i++){let o=e.getVertex(i);o=this.putCameraAtCenterOfPointCoordinateSystem(o),r.push(o);}return t.vertices=new g(r),t}putCameraAtCenterOfPointCoordinateSystem(e){return e=this.shiftWorldPointIntoCameraSpace(e),e=this.projectWorldPointOntoCameraAxis(e),e}shiftWorldPointIntoCameraSpace(e){return s.sub(e,this.#e.position)}projectWorldPointOntoCameraAxis(e){let t=s.dotProduct(e,this.#a),r=s.dotProduct(e,this.#n),i=s.dotProduct(e,this.#t);return new s(t,r,i)}copy(){return new n(this.#e.copy(),this.#t.copy(),this.#r,this.#i,this.#o)}pointAtPoint(e){if(!(e instanceof s))throw Error("point is not an instance of Vector");this.viewVector=s.unitVector(s.sub(e,this.#e.position));}pointInDirection(e){if(!(e instanceof s))throw Error("direction is not an instance of Vector");this.viewVector=s.unitVector(e);}};var O=class n{#e;#t;constructor(e,t){this.#e=e,this.#t=t;}getLight(e){return this.#t[e]}getEntity(e){return this.#e[e]}copy(){return new n(this.#e.map(e=>e.copy()),this.#t.map(e=>e.copy()))}get numEntities(){return this.#e.length}get numLights(){return this.#t.length}setLightPos(e,t){w.hasPosition(this.#t[t])&&(this.#t[t].position=e);}set meshes(e){if(!Array.isArray(e))throw Error("meshes is not an array");this.meshes=e;}};var H=class{#e;#t;#r;#i;#o;#n;#a;#s;#l;#h;#c;constructor(e,t,r,i=1){this.#o=0,this.#i=0,this.#n=false,this.#r=e,this.#t=t,this.#e=r,this.#a=.01,this.#s=new s(1,0,0),this.#l=new s(0,1,0),this.#h=s.unitVector(s.crossProduct(this.#s,this.#l)),this.#c=i,this.viewVector=this.#s;}set vTheta(e){if(!Number.isFinite(e))throw Error("vTheta is not finite");Math.cos(this.#i)<0?this.#n=true:this.#n=false,this.#i=e,this.updateViewDirectionFromAngles();}set hTheta(e){if(!Number.isFinite(e))throw Error("hTheta is not finite");this.#o=e,this.updateViewDirectionFromAngles();}get vTheta(){return this.#i}get hTheta(){return this.#o}set viewVector(e){this.#s=s.unitVector(e),this.#l=s.upVector(),(this.#s.equals(s.upVector())||this.#s.equals(s.downVector()))&&(this.#l=new s(1,0,0)),this.#h=s.unitVector(s.crossProduct(this.#s,this.#l)),this.#l=s.unitVector(s.crossProduct(this.#s,this.#h)),this.updateAnglesFromViewDirection();}updateViewDirectionFromAngles(){let e=Math.abs(Math.cos(this.#i)),t=new s(Math.cos(this.#o)*e,0,Math.sin(this.#o)*e),r=new s(0,Math.sin(this.#i),0);this.viewVector=s.unitVector(s.add(t,r));}updateAnglesFromViewDirection(){let e=s.unitVector(this.#s);this.#i=Math.asin(e.y),this.#o=Math.atan2(e.z,e.x);}updateKinematics(){this.#r=s.add(this.#r,this.#t),this.#t=s.add(this.#t,this.#e),this.#t=s.scalarMult(this.#t,.98),this.#e=s.zero();}update(e){let t=e.copy();return t.position=this.#r,t.pointInDirection(this.#s),this.updateKinematics(),t}keyboardInputs(e){let t=e.movementInCertainCoordinateSystem(this.#s,this.#l,this.#h);t=s.scalarMult(t,this.#c),this.#e=s.add(this.#e,t);}mouseInputRotate(e,t){Number.isFinite(t)||(t=0),Number.isFinite(e)||(e=0),e=e*this.#a,t=t*this.#a,this.hTheta=this.#o+e,this.vTheta=this.#i+(this.#n?1:-1)*t;}};var W=class{#e;#t;#r;#i;#o;#n=.01;constructor(e,t,r,i){this.#e=e,this.#t=t,this.#r=r,this.#i=i,this.#o=false;}update(e){let t=e.copy(),r=Math.abs(this.#t*Math.cos(this.#i));Math.cos(this.#i)<0?this.#o=true:this.#o=false;let i=new s(Math.cos(this.#r)*r,0,Math.sin(this.#r)*r),o=new s(0,this.#t*Math.sin(this.#i),0),l=s.add(this.#e,i,o);return e.position=l,e.pointAtPoint(this.#e),t}changeRadius(e){this.#t+=e;}mouseInputRotate(e,t,r,i){let o=(r-e)*this.#n,l=(i-t)*this.#n;this.#r+=o,this.#i+=(this.#o?-1:1)*l;}get radius(){return this.#t}};var E=class{camera;scene;renParam;constructor(e,t,r){this.scene=e,this.camera=t,this.renParam=r;}mainGraphFunctionalPreWork(){}mainGraphFunctionalPostWork(){}setSceneLightPos(e,t){this.scene.setLightPos(e,t);}getSceneInZOrder(){let e=[];for(let t=0;t<this.scene.numEntities;t++)e.push({type:"entity",ref:t,z:this.getCameraSpaceMesh(this.scene.getEntity(t)).calculateAverageZ()});for(let t=0;t<this.scene.numLights;t++){let r=this.scene.getLight(t);if(!w.hasPosition(r))continue;let i=this.finalLightPosition(r);e.push({type:"light",ref:t,light:r,finalLightPosition:i,z:i.canvasPosition.z});}return e.sort((t,r)=>r.z-t.z),e.filter(t=>t.z>=0)}graph(){this.mainGraphFunctionalPreWork(),this.mainGraphRenderingPreWork();let e=this.getSceneInZOrder();for(let t of e)t.type=="entity"&&this.graphEntity(this.scene.getEntity(t.ref)),t.type=="light"&&this.renParam.showLights&&this.graphLight(t);this.mainGraphRenderingPostWork(),this.mainGraphFunctionalPostWork();}getColorOfTriangle(e,t,r,i,o,l){return o.calculateTriangleColor({trianglePosition:r,triangleNormalVector:i,triangleColor:t,distance:l})}getColorOfTrianglesFromLight(e,t,r,i,o,l,a){let c=-1/0;w.hasPosition(o)&&(c=s.distanceBetweenVectors(l,o.position),c==0&&(c=1));for(let h=0;h<e.numTriangles;h++){let u=this.getColorOfTriangle(e,t[h],r[h],i[h],o,c);a[h].addInto(u);}return a}getColorsOfTrianglesFromAllLights(e,t,r,i,o){let l=new Array(e.numTriangles);for(let a=0;a<l.length;a++)l[a]=new V(0,0,0);for(let a=0;a<this.scene.numLights;a++){let c=this.scene.getLight(a);l=this.getColorOfTrianglesFromLight(e,t,r,i,c,o,l);}for(let a=0;a<l.length;a++)l[a]=l[a].clampColor();return l}finalLightPosition(e){let t=this.camera.putCameraAtCenterOfPointCoordinateSystem(e.position),r=this.camera.focalDistance/t.z,i=e.radius*r;return t=this.projectIndividualPoint(t),t=this.pointToCanvas(t),{canvasPosition:t,radius:i}}getCameraSpaceMesh(e){e=e.copy();let t=e.worldSpaceMesh;return this.camera.putCameraAtCenterOfMeshCoordinateSystem(t)}graphEntity(e){let t=e.worldSpaceMesh,r=e.triangleColors,i=t.triangleCentroids,o=t.triangleNormalVectors;e.isIndifferentToLight||(r=this.getColorsOfTrianglesFromAllLights(t,r,i,o,e.physicsBody.position)),t.calculateTrianglesNormalVectors();let l=t.mapTrianglesToAnyObject(r);t=this.getCameraSpaceMesh(e),!this.renParam.isWindingOrderBackFaceCulling&&this.renParam.doBackFaceCulling&&(t=this.backFaceCulling_Normal(t));let a;if(a=t.calculateTrianglesNormalVectors(),t=this.applyProjection(t),this.isAnyMeshPointBehindCamera(t))return;if(this.renParam.isWindingOrderBackFaceCulling&&this.renParam.doBackFaceCulling){let u=t.mapTrianglesToAnyObject(a);t=this.backFaceCulling_WindingOrder(t),a=t.findAnyObjectFromMap(u);}let c=t.findAnyObjectFromMap(l),h=t;t=this.meshToCanvas(t),this.renParam.doVertices&&this.graphVertices(t),this.renParam.doTriangles&&this.graphTriangles(t,c),this.renParam.doNormalVectors&&this.graphNormalVectors(h,a,this.renParam.normalVectorLength);}isAnyMeshPointBehindCamera(e){for(let t=0;t<e.numPoints;t++)if(e.getVertex(t).z===-1/0)return  true;return  false}generateMeshWithAppropriateColorsWithOnlyVisiblePartsOfTriangles(e,t){let r=[],i=e.copy(),o=new Map,l=this.getHiddenPoints(i);for(let h=0;h<l.length;h++)o.set(l[h],true);let a=[],c=[];for(let h=0;h<i.numTriangles;h++){let u=e.getTriangle(h),m=this.whichPointsInMap(i,u,o),d=m.length;d!==3&&(d===1?c.push({triangle:u,vector:m[0]}):d===2?a.push({triangle:u,vectors:m}):d===0&&r.push(u),r.push(u));}i.triangles=r;for(let h=0;h<a.length;h++){let u=this.generateNewMeshWithAppropriateColorsWithNewVisibleTriangleFromOneTriangleWithTwoHiddenVertices(a[h].triangle,a[h].vectors,i,t);i=u.mesh,t=u.colorMap;}for(let h=0;h<c.length;h++){let u=this.generateNewMeshWithAppropriateColorsWithTwoNewVisibleTrianglesFromOneTriangleWithHiddenVertex(c[h].triangle,c[h].vector,i,t);i=u.mesh,t=u.colorMap;}return i}generateNewMeshWithAppropriateColorsWithNewVisibleTriangleFromOneTriangleWithTwoHiddenVertices(e,t,r,i){if(t.length!==2)throw Error("hiddenVertices.length !== 2");let o=-1/0;for(let y=0;y<3;y++){let M=e.getVerticeReference(y),N=r.getVertex(M);for(let I=0;I<t.length;I++)t[I].equals(N)||(o=M);}if(o===-1/0)throw Error("Fatal error, malformed inputs likely the case");let l=this.findPointBetweenTwoPointsAtZeroZ(t[0],r.getVertex(o)),a=this.findPointBetweenTwoPointsAtZeroZ(t[1],r.getVertex(o)),c=r.vertices;c.addVertex(l);let h=c.numPoints-1;c.addVertex(a);let u=c.numPoints-1,m=new T([h,u,o]),d=r.triangles;d.push(m);let b=m.getDistinctIdentifier(),P=i.get(e.getDistinctIdentifier());return P!=null?i.set(b,P):i.set(b,new V(255,255,255)),{mesh:new x(r.vertices,d),colorMap:i}}generateNewMeshWithAppropriateColorsWithTwoNewVisibleTrianglesFromOneTriangleWithHiddenVertex(e,t,r,i){let o=[];for(let y=0;y<3;y++){let M=e.getVerticeReference(y),N=r.getVertex(M);t.equals(N)||o.push(M);}if(o.length!==2)throw Error(" fatal error, visible vertice references.length !== 2");let l=this.findPointBetweenTwoPointsAtZeroZ(t,r.getVertex(o[0])),a=this.findPointBetweenTwoPointsAtZeroZ(t,r.getVertex(o[1])),c=r.vertices;c.addVertex(l);let h=c.numPoints-1;c.addVertex(a);let u=c.numPoints-1,m=new T([h,u,o[0]]),d=r.triangles;d.push(m);let b=m.getDistinctIdentifier(),P=i.get(e.getDistinctIdentifier());return P!=null?i.set(b,P):i.set(b,new V(255,255,255)),m=new T([u,o[1],o[0]]),d.push(m),b=m.getDistinctIdentifier(),P=i.get(e.getDistinctIdentifier()),P!=null?i.set(b,P):i.set(b,new V(255,255,255)),{mesh:new x(r.vertices,d),colorMap:i}}findPointBetweenTwoPointsAtZeroZ(e,t){let r=e.x+(t.x-e.x)*(-e.z/(t.z-e.z)),i=e.y+(t.y-e.y)*(-e.z/(t.z-e.z)),o=0;return new s(r,i,o)}whichPointsInMap(e,t,r){let i=[];for(let o=0;o<3;o++){let l=t.getVerticeReference(o),a=e.getVertex(l);r.has(a)&&i.push(a);}return i}getHiddenPoints(e){let t=[];for(let r=0;r<e.numPoints;r++){let i=e.getVertex(r);i.z===-1/0&&t.push(i);}return t}backFaceCulling_Normal(e){let t=new s(0,0,1),i=e.copy(),o=[],l=i.calculateTrianglesNormalVectors();for(let a=0;a<e.numTriangles;a++){let c;this.renParam.isPerspective?c=s.sub(l[a].position,new s(0,0,0)).isDotProductLEThanX(l[a].direction,0):c=t.isDotProductLEThanX(l[a].direction,0),c&&o.push(e.getTriangle(a));}return i.triangles=o,i}backFaceCulling_WindingOrder(e){let t=e.copy(),r=[];for(let i=0;i<t.numTriangles;i++){let o=t.getTriangle(i),l=t.getVertex(o.getVerticeReference(0)),a=t.getVertex(o.getVerticeReference(1)),c=t.getVertex(o.getVerticeReference(2)),h=s.sub(a,l),u=s.sub(c,l);h.x*u.y-u.x*h.y>0&&r.push(o);}return t.triangles=r,t}orthographicProjectIndividualVector(e){this.camera.focalDistance;return e.z<0&&(-1/0),new s(e.x,e.y,this.camera.focalDistance)}perspectiveProjectIndividualVector(e){let t=this.camera.focalDistance/e.z,r=e.x*t,i=e.y*t,o=e.z;return e.z<0&&(o=-1/0),new s(r,i,o)}orthographicProjectNormalVectorIntoLine(e,t){let r=this.orthographicProjectIndividualVector(e.position),i=this.orthographicProjectIndividualVector(s.add(s.scalarMult(e.direction,t),e.position));return new C(r,i)}perspectiveProjectNormalVectorIntoLine(e,t){let r=this.perspectiveProjectIndividualVector(e.position),i=this.perspectiveProjectIndividualVector(s.add(s.scalarMult(e.direction,t),e.position));return new C(r,i)}projectNormalVectorsIntoLines(e,t){let r=[];for(let i of e){let o=this.renParam.isPerspective?this.perspectiveProjectNormalVectorIntoLine(i,t):this.orthographicProjectNormalVectorIntoLine(i,t);o.p1.z!=-1/0&&o.p2.z!=-1/0&&r.push(o);}return r}applyProjection(e){let t=e.copy(),r=[];for(let o=0;o<t.numPoints;o++){let l,a=t.getVertex(o);l=this.projectIndividualPoint(a),r.push(l);}let i=new g(r);return t.vertices=i,t}projectIndividualPoint(e){return this.renParam.isPerspective?e=this.perspectiveProjectIndividualVector(e):e=this.orthographicProjectIndividualVector(e),e}};var S=class extends E{#e;#t;constructor(e,t,r,i,o){super(e,r,i),o.createCanvas(t.x,t.y),this.#t=o,this.#e=o.createGraphics(t.x,t.y);}mainGraphRenderingPreWork(){this.#e.clear(),this.#e.background(0);}mainGraphRenderingPostWork(){this.#t.image(this.#e,0,0);}meshToCanvas(e){let t=e.copy(),r=[];for(let i=0;i<t.numPoints;i++)r.push(this.pointToCanvas(e.getVertex(i)));return e.vertices=new g(r),e}pointToCanvas(e){return this.calculateCanvasPos(e)}calculateCanvasPos(e){return s.add(new s(this.#e.width/2,this.#e.height/2,0),e)}linesToCanvas(e){let t=[];for(let r of e)t.push(new C(this.calculateCanvasPos(r.p1),this.calculateCanvasPos(r.p2)));return t}graphVertices(e){for(let t=0;t<e.numPoints;t++)this.graphVertex(e.getVertex(t),new V(0,0,0),3);}graphLight(e){this.graphVertex_noStroke(e.finalLightPosition.canvasPosition,e.light.color,e.finalLightPosition.radius);}graphVertex_noStroke(e,t,r){this.#e.noStroke(),this.#e.fill(this.convertColorHandlerToP5(t)),this.graphVertex(e,t,r);}graphVertex(e,t,r){this.#e.circle(e.x,e.y,r);}graphTriangle(e,t){let r=e.getVertex(t.getVerticeReference(0)),i=e.getVertex(t.getVerticeReference(1)),o=e.getVertex(t.getVerticeReference(2));this.#e.strokeJoin(this.#t.ROUND),this.#e.stroke(this.#t.color(0)),this.#e.triangle(r.x,r.y,i.x,i.y,o.x,o.y);}graphTriangles(e,t){for(let r=0;r<e.numTriangles;r++){let i=e.getTriangle(r);this.#e.fill(this.convertColorHandlerToP5(t[r])),this.graphTriangle(e,i);}}graphLines(e,t){for(let r of e)this.graphLine(r,t);}graphLine(e,t){this.graphBetweenTwoPoints(e.p1,e.p2,t);}graphBetweenTwoPoints(e,t,r){this.#e.stroke(r),this.#e.line(e.x,e.y,t.x,t.y);}convertColorHandlerToP5(e){return this.#t.color(e.red,e.green,e.blue)}graphNormalVectors(e,t,r){let i=this.projectNormalVectorsIntoLines(t,r),o=this.linesToCanvas(i);this.graphLines(o,this.#t.color(255));}copy(){}};var k=class{#e;#t;#r;#i;#o;#n;#a;#s;#l;#h;#c;#u;#p;constructor({doBackFaceCulling:e=true,doOutline:t=true,doFill:r=true,doVertices:i=false,doShadingWithLighting:o=true,lineWidth:l=1,pointRadius:a=3,isPerspective:c=true,doTriangles:h=true,isWindingOrderBackFaceCulling:u=true,doNormalVectors:m=false,normalVectorLength:d=30,showLights:b=true}={}){this.#e=e,this.#t=t,this.#r=r,this.#i=i,this.#o=o,this.#n=l,this.#a=a,this.#s=c,this.#l=h,this.#h=u,this.#c=m,this.#u=d,this.#p=b;}get doBackFaceCulling(){return this.#e}get doOutline(){return this.#t}get doFill(){return this.#r}get doVertices(){return this.#i}get doShadingWithLighting(){return this.#o}get lineWidth(){return this.#n}get pointRadius(){return this.#a}get isPerspective(){return this.#s}get doTriangles(){return this.#l}get isWindingOrderBackFaceCulling(){return this.#h}get doNormalVectors(){return this.#c}get normalVectorLength(){return this.#u}get showLights(){return this.#p}set doBackFaceCulling(e){if(typeof e!="boolean")throw new TypeError("doBackFaceCulling must be boolean");this.#e=e;}set doOutline(e){if(typeof e!="boolean")throw new TypeError("doOutline must be boolean");this.#t=e;}set doFill(e){if(typeof e!="boolean")throw new TypeError("doFill must be boolean");this.#r=e;}set doVertices(e){if(typeof e!="boolean")throw new TypeError("doVertices must be boolean");this.#i=e;}set doShadingWithLighting(e){if(typeof e!="boolean")throw new TypeError("doShadingWithLighting must be boolean");this.#o=e;}set lineWidth(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("lineWidth must be a positive finite number");this.#n=e;}set pointRadius(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("pointRadius must be a positive finite number");this.#a=e;}set isPerspective(e){if(typeof e!="boolean")throw new TypeError("isPerspective must be boolean");this.#s=e;}set doTriangles(e){if(typeof e!="boolean")throw new TypeError("doTriangles must be boolean");this.#l=e;}set isWindingOrderBackFaceCulling(e){if(typeof e!="boolean")throw new TypeError("isWindingOrderBackFaceCulling must be boolean");this.#h=e;}set doNormalVectors(e){if(typeof e!="boolean")throw new TypeError("doNormalVectors must be boolean");this.#c=e;}set normalVectorLength(e){if(typeof e!="number"||!Number.isFinite(e)||e<=0)throw new TypeError("normalVectorLength must be a positive finite number");this.#u=e;}set showLights(e){if(typeof e!="boolean")throw new TypeError("showLights must be boolean");this.#p=e;}};var D=class{#e;#t;#r;#i;#o;#n;constructor(){this.#e=false,this.#t=false,this.#r=false,this.#i=false,this.#o=false,this.#n=false;}get up(){return this.#e}get down(){return this.#t}get left(){return this.#r}get right(){return this.#i}get space(){return this.#n}get control(){return this.#o}set up(e){if(typeof e!="boolean")throw Error("poor input");this.#e=e;}set down(e){if(typeof e!="boolean")throw Error("poor input");this.#t=e;}set left(e){if(typeof e!="boolean")throw Error("poor input");this.#r=e;}set right(e){if(typeof e!="boolean")throw Error("poor input");this.#i=e;}set space(e){if(typeof e!="boolean")throw Error("poor input");this.#n=e;}set control(e){if(typeof e!="boolean")throw Error("poor input");this.#o=e;}updateLeftRightUpDown(e,t,r,i){this.up=r,this.down=i,this.left=e,this.right=t;}updateControlSpace(e,t){this.control=e,this.space=t;}movementInCertainCoordinateSystem(e,t,r){e=s.unitVector(e),t=s.unitVector(t),r=s.unitVector(r);let i=s.zero();return this.#e&&(i=s.add(i,e)),this.#t&&(i=s.add(i,s.oppositeVector(e))),this.#r&&(i=s.add(i,s.oppositeVector(r))),this.#i&&(i=s.add(i,r)),this.#o&&(i=s.add(i,s.oppositeVector(t))),this.#n&&(i=s.add(i,t)),i}};exports.Camera=R;exports.CameraMover=H;exports.CameraSpotTracker=W;exports.DirectionalLight=A;exports.Entity=z;exports.Field=g;exports.KeyboardInput=D;exports.Mesh=x;exports.MeshGenerator=F;exports.PhysicsBody=B;exports.PointLight=L;exports.RenderParameters=k;exports.Scene=O;exports.Vector=s;exports.p5Renderer=S;return exports;})({});